extends layout
block content

    h1 'Video!'

    script.

        function hasGetUserMedia() {
            return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
                navigator.mozGetUserMedia || navigator.msGetUserMedia);
        }

        if (hasGetUserMedia()) {
            // Good to go!
        } else {
        alert('getUserMedia() is not supported in your browser');
        }

    video( autoplay = 'autoplay')


    script.
        var errorCallback = function(e) {
            console.log('Reeeejected!', e);
        };

        function successCallback(stream) {
            var video = document.querySelector('video');
            video.src = window.URL.createObjectURL(stream);
        }

        MediaStreamTrack.getSources(function(sourceInfos) {
        var videoSource = null;

        for (var i = 0; i != sourceInfos.length; ++i) {
        var sourceInfo = sourceInfos[i];
        if (sourceInfo.kind === 'video') {
        console.log(sourceInfo.id, sourceInfo.label || 'camera');

        videoSource = sourceInfo.id;
        } else {
        console.log('Some other kind of source: ', sourceInfo);
        }
        }

        sourceSelected(videoSource);
        });

        function sourceSelected(videoSource) {
            var constraints = {
                video: {
                optional: [{sourceId: videoSource}]
        }
        };

        navigator.getUserMedia(constraints, successCallback, errorCallback);
        }